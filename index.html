<script>
    document.getElementById('emailForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const form = e.target;
        const responseDiv = document.getElementById('formResponse');
        
        // 1. Get the values
        const fname = document.getElementById('firstName').value;
        const email = document.getElementById('emailInput').value;
        const interest = document.getElementById('interest').value;

        // 2. Prepare the Mailchimp JSONP URL
        // We change 'post' to 'post-json' and add '&c=?' for JSONP support
        const url = "https://gmail.us14.list-manage.com/subscribe/post-json?u=475649f6927ace2359a3cfc50&id=11e7b20f6d" 
                    + "&FNAME=" + encodeURIComponent(fname) 
                    + "&EMAIL=" + encodeURIComponent(email) 
                    + "&INTEREST=" + encodeURIComponent(interest) 
                    + "&c=jsonpCallback";

        // 3. Create the JSONP script tag
        const script = document.createElement('script');
        script.src = url;
        document.body.appendChild(script);

        // 4. Update the UI immediately
        form.style.display = 'none';
        responseDiv.style.display = 'block';
        responseDiv.innerHTML = "<h3>Processing...</h3>";
    });

    // 5. This function runs when Mailchimp responds
    window.jsonpCallback = function(data) {
        const responseDiv = document.getElementById('formResponse');
        if (data.result === 'success') {
            responseDiv.innerHTML = "<h3>Success! ðŸŽ¬</h3><p>Thank you for joining the journey. Please check your inbox to confirm.</p>";
        } else {
            // If there's an error (like 'already subscribed'), show it
            responseDiv.innerHTML = "<h3>Note</h3><p>" + data.msg + "</p><button onclick='window.location.reload()' class='btn btn-secondary' style='margin-top:10px;'>Try Again</button>";
        }
    };
</script>
